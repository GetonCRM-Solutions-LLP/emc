<template>
    <div role="dialog" class="doc-container" if:true={nameOfDriver}>
        <div class="embedded-chat">
            <header class="sidebarHeader">
                <div class="header_main">
                    <div class="avatar_main">
                        <img src={avatar} class="avatar-img" />
                    </div>
                    <h2 class="chat-contact-name">{nameOfDriver}</h2>
                </div>
                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close"
                    onclick={handleClose}>
                    <lightning-icon icon-name="utility:close" size="x-small" class="closeButton">
                        <svg focusable="false" data-key="check" class="slds-button__icon slds-button__icon_large"
                            aria-hidden="true">
                            <use xlink:href="#check" class="slds-icon-text-default"></use>
                        </svg>
                    </lightning-icon>
                    <span class="slds-assistive-text">Close</span>
                </button>
            </header>
            <div class="sidebarBody">
                <div></div>
                <div class="chatActive">
                    <div class="stateBody">
                        <div class="messageArea">
                            <div tabindex="0" class="messageContent">
                                <div class="bot-title">Text Messages</div>
                                <template if:true={filterMessage}>
                                    <template for:each={filterMessage} for:item="list">
                                        <div class="conversation-start" key={list.aId}>
                                            <span if:true={list.isString}>{list.Title}</span>
                                            <span if:false={list.isString}>
                                                <lightning-formatted-date-time value={list.Title} year="numeric"
                                                    day="2-digit" month="long"></lightning-formatted-date-time>
                                            </span>
                                        </div>
                                        <ul class="messageWrapper" key={list.aId}>
                                            <template if:true={list.Messages}>
                                                <template for:each={list.Messages} for:item="record">
                                                    <li class="chatMessage" key={record.Id}>
                                                        <div if:false={record.Incoming_Message__c}
                                                            class="chat_container">
                                                            <div class="chat__message-truedialog chat__message-sender">
                                                                    <div if:false={record.Media_Link__c}>
                                                                        <p class="word-style">{record.Message__c}</p>
                                                                    </div>
                                                                    <div if:true={record.Media_Link__c}>
                                                                        <div if:false={record.Message__c}>
                                                                            <img class="image-record" src={record.Media_Link__c} loading="lazy"/>
                                                                       </div>
                                                                       <div if:true={record.Message__c}>
                                                                           <img class="image-record" src={record.Media_Link__c} loading="lazy"/>
                                                                           <p class="word-style">{record.Message__c}</p>
                                                                      </div>
                                                                    </div>
                                                            </div>
                                                            <div
                                                                class="slds-grid slds-grid_vertical-align-center slds-grid_align-end chat_message-time slds-p-vertical_medium">
                                                                <lightning-formatted-date-time value={record.parseValue}
                                                                    hour="2-digit" minute="2-digit"
                                                                    time-zone="America/Panama">
                                                                </lightning-formatted-date-time>
                                                            </div>
                                                        </div>

                                                        <div if:true={record.Incoming_Message__c}
                                                            class="chat_container">
                                                            <div
                                                                class="chat__message-truedialog chat__message-receiver">
                                                                <div class="date"></div>
                                                                <div if:false={record.Media_Link__c}>
                                                                    <p class="word-style">{record.Message__c}</p>
                                                                </div>
                                                                <div if:true={record.Media_Link__c}>
                                                                    <div if:false={record.Message__c}>
                                                                         <img class="image-record" src={record.Media_Link__c} loading="lazy"/>
                                                                    </div>
                                                                    <div if:true={record.Message__c}>
                                                                        <img class="image-record" src={record.Media_Link__c} loading="lazy"/>
                                                                        <p class="word-style">{record.Message__c}</p>
                                                                   </div>
                                                                </div>
                                                            </div>
                                                            <div
                                                                class="slds-grid slds-grid_vertical-align-center slds-grid_align-end chat_message-time slds-p-vertical_medium">
                                                                <lightning-formatted-date-time value={record.parseValue}
                                                                    hour="2-digit" minute="2-digit"
                                                                    time-zone="America/Panama">
                                                                </lightning-formatted-date-time>
                                                            </div>
                                                        </div>
                                                        <!--{record.Contacts__r.Time_Zone__c}-->
                                                        <!-- <section aria-describedby="dialog-body-id-109" aria-label="Dialog Title"
                                                                class="slds-popover slds-nubbin_right-top slds-popover_small slds-popover_admin" role="dialog" if:false={record.Incoming_Message__c}>
                                                                <div class="slds-popover__body">
                                                                    <div class="slds-media">
                                                                        <div class="slds-media__body">
                                                                            <p>{record.Message__c}</p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <footer class="slds-popover__footer">
                                                                    <div class="slds-grid slds-grid_vertical-align-center slds-grid_align-end">
                                                                        <lightning-formatted-date-time value={record.parseValue} year="numeric" day="2-digit" month="long"></lightning-formatted-date-time>
                                                                        <span>&nbsp;</span>
                                                                        <lightning-formatted-date-time value={record.parseValue} hour="2-digit"
                                                                        minute="2-digit" time-zone={record.Contacts__r.Time_Zone__c}></lightning-formatted-date-time>
                                                                    </div>
                                                                </footer>
                                                            </section> -->
                                                        <!-- <section aria-describedby="dialog-body-id-109" aria-label="Dialog Title"
                                                                class="slds-popover slds-nubbin_left-top  slds-popover_small slds-popover_driver" role="dialog" if:true={record.Incoming_Message__c}>
                                                                <div class="slds-popover__body">
                                                                    <div class="slds-media">
                                                                        <div class="slds-media__body">
                                                                            <p>{record.Message__c}</p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <footer class="slds-popover__footer">
                                                                    <div class="slds-grid slds-grid_vertical-align-center slds-grid_align-end">
                                                                        <lightning-formatted-date-time value={record.parseValue} year="numeric" day="2-digit" month="long"></lightning-formatted-date-time>
                                                                        <span>&nbsp;</span>
                                                                        <lightning-formatted-date-time value={record.parseValue} hour="2-digit"
                                                                        minute="2-digit" time-zone={record.Contacts__r.Time_Zone__c}></lightning-formatted-date-time>
                                                                    </div>
                                                                </footer>
                                                            </section> -->
                                                    </li>
                                                </template>
                                            </template>
                                            <template if:false={messageRecords}>
                                                <li class="chatMessage">
                                                </li>
                                            </template>
                                        </ul>
                                    </template>
                                </template>
                                <template if:false={filterMessage}>
                                    <div class='spinner'>
                                        <div class='bounce1'></div>
                                        <div class='bounce2'></div>
                                        <div class='bounce3'></div>      
                                    </div>
                                </template>
                                <template if:true={messageLoading}>
                                    <div class="chat_container">
                                        <div class="chat__message-truedialog chat__message-sender">
                                            <div class='spinner'>
                                                <div class='bounce1'></div>
                                                <div class='bounce2'></div>
                                                <div class='bounce3'></div>      
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        <div class="inputWrapper" tabindex="-1"  ondrop={handleDropFile} ondragstart={handleDragStart}>
                            <div class="message-controls slds-grid">
                                <div class={textStyle}>
                                    <textarea class="slds-textarea message-input" role="textbox" rows="2"
                                    placeholder="Type your message..." onkeypress={onKeyPress} oninput={onCreateSMS} ></textarea>
                                </div>
                                <div class={imageHolderStyle}>
                                    <div class="close-image" if:true={imageUploaded}>
                                        <button class="slds-button slds-button_brand btn-brand-padding slds-modal__close" onclick={removeSelection}>
                                            <i class="fa-solid fa-xmark"></i>
                                        </button>
                                    </div>
                                    <img id="file-image" src=""  class={classForFile} style="height: auto;"><!--https://mburse--partialdev--c.documentforce.com/servlet/servlet.ImageServer?id=0158H0000000hV2QAI&oid=00D8H0000008fkf-->
                                </div>
                                <div class="slds-col slds-p-horizontal_medium">
                                    <div class="file-upload-button">
                                        <label>
                                            <input type="file" class="file-input" accept="image/png, image/jpeg" onchange={inputChange}>
                                            <span class="chat__input-fileupload naoTooltip-wrap">
                                                <i class="fa-solid fa-circle-plus attachment-icon fa-xl"></i>
                                                <div class="naoTooltip nt-top nt-small">
                                                    Attachments
                                                </div>
                                            </span>
                                        </label>
                                        <button class="slds-button slds-p-left_small slds-button_icon send_chat_button" onclick={onSendMessage}>
                                            <i class="fa-solid fa-paper-plane send-icon fa-xl"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- <div class="file-upload-button">
                                <img id="file-image" src=""  class="chat__file-image">
                                <label>
                                    <input type="file" class="file-input" accept="image/png, image/jpeg" onchange={inputChange}>
                                    <span class="chat__input-fileupload naoTooltip-wrap">
                                        <i class="fa-solid fa-circle-plus attachment-icon fa-xl"></i>
                                        <div class="naoTooltip nt-top nt-small">
                                            Attachments
                                        </div>
                                    </span>
                                </label>
                                <button class="slds-button slds-p-left_small slds-button_icon send_chat_button" onclick={onSendMessage}>
                                    <i class="fa-solid fa-paper-plane send-icon fa-xl"></i>
                                </button>
                            </div> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>